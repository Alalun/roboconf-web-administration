
<!-- What happens when we click on 'Upload' -->
<script type="text/javascript">

	// Prepare the update of the progress bar
	var updateProgressBar = function( percentage ) {
		var progressBar = $( "#app-upload-progress-bar" );
		progressBar.css( "width", percentage + "%" );
		progressBar.text( percentage + "%" );
		progressBar.attr( "aria-valuenow", percentage )
	};
	
	// What happens when we click the "upload" button...
	$( "#new-app-form" ).submit( function( e ) {
		
		// Prevent the form from redirecting to the "action URL".
		e.stopPropagation();
		e.preventDefault();
		
		// Prepare the data to submit
		var formObj = $( this );
		var formData = new FormData( this );
			
		// Create an ajax request
		$.ajax({
			// This is to follow upload progression
			xhr: function() {
		        var xhr = new window.XMLHttpRequest();
		        xhr.upload.addEventListener("progress", function(evt) {
		            if( evt.lengthComputable ) {
		                var percentComplete = Math.round((evt.loaded * 100) / evt.total);
		                updateProgressBar( percentComplete );
		            }
		       }, false);

		       return xhr;
		    },
		    
		    // Other properties
			url : formObj.attr( "action" ),
			type : formObj.attr( "method" ),
			data : formData,
			mimeType : formObj.attr( "enctype" ),
			contentType : false,
			cache : false,
			processData : false,
			
			// Callbacks on success or failure
			success : function(data, textStatus, jqXHR) {
				$( "#upload-result" ).text( "The application was succesfully uploaded." );
			},
			error : function(jqXHR, textStatus, errorThrown) {
				$( "#upload-result" ).html( jqXHR.responseText );
			}
		});
			
		return false;
	});
	
</script>
